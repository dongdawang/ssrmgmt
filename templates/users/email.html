{% extends 'users/userbase.html' %}

{#{% block title %}<title>JJJJJ</title> {% endblock %}#}
{% block test %}<a href="#" class="list-group-item">个人中心</a>{% endblock %}

{# 放置自定义的样式 #}
{% block style %}

{% endblock %}

{# 放置用户信息目录 #}
{% block usernav %}
    <div class="list-group">
        <a href="{% url 'users:profile' %}" class="list-group-item">个人信息</a>
        <a href="{% url 'users:modify-pwd' %}" class="list-group-item">修改密码</a>
        <a href="{% url 'users:modify-email' %}" class="list-group-item active">修改邮箱</a>
        <a href="{% url 'users:usercharts' %}" class="list-group-item">用户图表</a>
        <a href="{% url 'users:accounts' %}" class="list-group-item">用户SSR账号</a>
    </div>
{% endblock %}

{# 放置用户内容 #}
{% block usercontent %}
    <div class="jumbotron">
        <div class="row">
            <div class="col-6 col-md-6 offset-md-3">
                <h4>邮箱修改</h4>
                <form action="{% url 'users:modify-email' %}" method="post">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">当前邮箱</span>
                        </div>
                        <input type="text" class="form-control" value="{{ request.user.email }}" readonly="readonly">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">变更邮箱</span>
                        </div>
                        {% if target_email %}
                            <input type="text" class="form-control" id="email" name="email" value="{{ target_email }}">
                        {% else %}
                            <input type="text" class="form-control" id="email" name="email" value="">
                        {% endif %}
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">验证码</span>
                        </div>
                        <input type="text" class="form-control" id="code" name="code" value="">
                        <div class="input-group-append">
                            <button class="btn btn-secondary" onclick="send_email();">获取验证码</button>
                        </div>
                    </div>
                    {% if status %}
                        <div class="alert alert-danger alert-dismissable">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>失败!</strong> {{ status }}
                        </div>
                    {% endif %}
                    <button class="btn btn-success btn-block" type="submit">确认修改邮箱</button>
                    {% csrf_token %}
                </form>
            </div>
            <div class="col-12 col-md-3"></div>
        </div>
    </div>
{% endblock %}

{# 放置自定义的脚本 #}
{% block script %}
    <script language="JavaScript">
        function send_email() {
            var params = {
                "email": $("#email").val(),
                "csrfmiddlewaretoken": $("input[name='csrfmiddlewaretoken']").val(),
            };
            alert(params.email);
            $.ajax({
                type: "POST",
                url: "{% url 'users:send_mail' %}",
                data: params,
                dataType: "json",
                success: function (respMsg) {
                }
            });
        }
    </script>
{% endblock %}
